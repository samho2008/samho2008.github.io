(window.webpackJsonp=window.webpackJsonp||[]).push([[231],{2094:function(a,s,t){"use strict";t.r(s);var e=t(34),r=Object(e.a)({},(function(){var a=this,s=a.$createElement,t=a._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"linux-添加虚拟内存-swap"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#linux-添加虚拟内存-swap"}},[a._v("#")]),a._v(" Linux 添加虚拟内存 swap")]),a._v(" "),t("h2",{attrs:{id:"查看磁盘使用情况"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看磁盘使用情况"}},[a._v("#")]),a._v(" 查看磁盘使用情况")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("free")]),a._v(" -h\n")])])]),t("h2",{attrs:{id:"添加-swap-分区"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#添加-swap-分区"}},[a._v("#")]),a._v(" 添加 Swap 分区")]),a._v(" "),t("p",[a._v("使用 "),t("code",[a._v("dd")]),a._v(" 命令创建名为 "),t("code",[a._v("swapfile")]),a._v(" 的 swap 交换文件（文件名和目录任意）：")]),a._v(" "),t("p",[t("strong",[a._v("注意：一般设置为物理内存的两倍，比如内存是 4G，那么虚拟内存 swap 就设置为 8G。")])]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("dd")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("if")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/dev/zero "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("of")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/var/swapfile "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("bs")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1024")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("count")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("8388608")]),a._v("\n")])])]),t("blockquote",[t("p",[a._v("/dev/zero 是 Linux 的一种特殊字符设备（输入设备），可以用来创建一个指定长度用于初始化的空文件，如临时交换文件，该设备无穷尽地提供 0，可以提供任何你需要的数目。")]),a._v(" "),t("p",[a._v("bs=1024：单位数据块（block）同时读入/输出的块字节大小为 1024 个字节(Byte)，即 1KB。bs（即 block size）。一般不需要修改。")]),a._v(" "),t("p",[a._v("count=8388608：表示 8G（计算公式为：1KB * 8388608 = 1KB * 1024(k) * 1024 * 8 = 8388608 = 8G，如果需要调整交换区的大小的话，可以自行计算设置其他的值")]),a._v(" "),t("p",[a._v("执行完命令后，会进行 8G 读写操作，所以会有一些卡顿，请耐心等待")])]),a._v(" "),t("h2",{attrs:{id:"设置-swap-分区权限"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#设置-swap-分区权限"}},[a._v("#")]),a._v(" 设置 swap 分区权限")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("chmod")]),a._v(" -R 0600 /var/swapfile\n")])])]),t("h2",{attrs:{id:"对交换文件格式化并转换为-swap-分区"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#对交换文件格式化并转换为-swap-分区"}},[a._v("#")]),a._v(" 对交换文件格式化并转换为 swap 分区")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkswap")]),a._v(" /var/swapfile\n")])])]),t("h2",{attrs:{id:"挂载并激活分区"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#挂载并激活分区"}},[a._v("#")]),a._v(" 挂载并激活分区")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("swapon")]),a._v(" /var/swapfile\n")])])]),t("h2",{attrs:{id:"查看新swap分区是否正常添加并激活使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看新swap分区是否正常添加并激活使用"}},[a._v("#")]),a._v(" 查看新swap分区是否正常添加并激活使用")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("free")]),a._v(" -h\n")])])]),t("h2",{attrs:{id:"修改-fstab-配置-设置开机自动挂载该分区"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#修改-fstab-配置-设置开机自动挂载该分区"}},[a._v("#")]),a._v(" 修改 fstab 配置，设置开机自动挂载该分区")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/var/swapfile swap swap defaults 0 0"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">>")]),a._v(" /etc/fstab\n")])])]),t("h2",{attrs:{id:"更改-swap-配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#更改-swap-配置"}},[a._v("#")]),a._v(" 更改 swap 配置")]),a._v(" "),t("p",[a._v("一般默认的情况，当我们开启交换虚拟内存空间后，默认是当内存使用 30% 的时候，就会开始使用交换空间，这样就会造成一个情况，就是本身物理内存还没有使用完成，却使用了虚拟内存，这样肯定会影响我们的使用效率，那么我们怎么避免这个情况的发生呢？")]),a._v(" "),t("p",[a._v("答案就是：可以通过设置 swappiness 值进行管理，swappiness 表示系统对 swap 分区的依赖程度，范围是 0~100，数值越大，依赖程度越高，也就是越高越会使用 swap 分区。")]),a._v(" "),t("p",[a._v("所以，我们现在并不希望我们的机器过度依赖 swap 分区，只有当我们负载超过某个百分比的时候，才使用交换空间，所以这也决定了，我们这个值并不是非常大，一般设置 10 ~ 50 左右。")]),a._v(" "),t("p",[a._v("当然如果小伙伴的是 SSD 的话，那么这个值可以稍微大一些。")]),a._v(" "),t("p",[a._v("下面我们查看当前的swappiness数值：")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("cat")]),a._v(" /proc/sys/vm/swappiness\n")])])]),t("p",[a._v("修改 swappiness 值，这里以 10 为例（默认是 30，即物理内存用到了 70% 就开始使用虚拟内存 swap）：")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("sysctl vm.swappiness"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("10")]),a._v("\n")])])]),t("p",[a._v("设置永久有效，重启系统后生效")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"vm.swappiness = 10"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">>")]),a._v(" /etc/sysctl.conf\n")])])]),t("p",[a._v("查看是否修改成功")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("cat")]),a._v(" /proc/sys/vm/swappiness\n")])])]),t("blockquote",[t("p",[a._v("参考资料：")]),a._v(" "),t("p",[t("a",{attrs:{href:"https://blog.csdn.net/wang5701071/article/details/109851696",target:"_blank",rel:"noopener noreferrer"}},[a._v("CentOS增加虚拟内存"),t("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=r.exports}}]);