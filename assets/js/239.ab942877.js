(window.webpackJsonp=window.webpackJsonp||[]).push([[239],{2104:function(s,a,t){"use strict";t.r(a);var n=t(34),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"ssh-免密登录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ssh-免密登录"}},[s._v("#")]),s._v(" SSH 免密登录")]),s._v(" "),t("p",[s._v("业务场景：")]),s._v(" "),t("p",[s._v("现在有两台服务器，服务器 A 和 服务器 B，要配置服务器 A 免密连接至服务器 B。")]),s._v(" "),t("p",[s._v("服务器 A 的 IP 地址为：192.168.202.205（用于免密连接至机器 B）")]),s._v(" "),t("p",[s._v("服务器 B 的 IP 地址为：192.168.202.206（被机器 A 免密连接）")]),s._v(" "),t("h2",{attrs:{id:"检查是否已经生成公钥和私钥"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#检查是否已经生成公钥和私钥"}},[s._v("#")]),s._v(" 检查是否已经生成公钥和私钥")]),s._v(" "),t("p",[s._v("首先，先检查服务器 A （主动连接到其他服务器的机器）是否已生成公钥和私钥。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" ~/.ssh\n")])])]),t("p",[s._v("如果出现以下提示，则说明当前用户还没有生成公钥和私钥。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls ~/.ssh")]),s._v("\nls: 无法访问/root/.ssh: 没有那个文件或目录\n")])])]),t("h2",{attrs:{id:"生成公钥和私钥"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#生成公钥和私钥"}},[s._v("#")]),s._v(" 生成公钥和私钥")]),s._v(" "),t("p",[s._v("如果还没有生成公钥和私钥，则在服务器 A 上生成公钥和私钥。")]),s._v(" "),t("p",[s._v("生成的过程中要求你输入一些参数，一路回车（Enter）使用默认配置即可。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("ssh-keygen\n")])])]),t("blockquote",[t("p",[s._v("说明：如果之前已经生成过公钥和私钥了，那么在执行以上命令时会提示你之前已经生成过了，是否要覆盖原来的私钥。")]),s._v(" "),t("p",[s._v("注意：如果之前已经生成过了，千万不要重新生成，否则会导致之前配置过的免密登录机器全部失效！（除非私钥泄露了，或者一些安全原因需要重新生成，只有这种情况下才能去执行这个覆盖命令）")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ssh-keygen")]),s._v("\nGenerating public/private rsa key pair.\nEnter "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("which")]),s._v(" to save the key "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("/root/.ssh/id_rsa"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": \n/root/.ssh/id_rsa already exists.\nOverwrite "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("y/n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("?\n")])])])]),s._v(" "),t("p",[s._v("参考执行日志：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ssh-keygen")]),s._v("\nGenerating public/private rsa key pair.\nEnter "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("which")]),s._v(" to save the key "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("/root/.ssh/id_rsa"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": \nCreated directory "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/root/.ssh'")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\nEnter passphrase "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("empty "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" no passphrase"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": \nEnter same passphrase again: \nYour identification has been saved "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" /root/.ssh/id_rsa.\nYour public key has been saved "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" /root/.ssh/id_rsa.pub.\nThe key fingerprint is:\nSHA256:RdUjHP4i5lUKKEJE/JtSBroS3ddUy560UMsEhnRdmeg root@localhost.localdomain\nThe key's randomart image is:\n+---"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("RSA "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("----+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   ++"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".+"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+=")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   .o .o.Bo"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+=")]),s._v(" o  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" o.o.oo.O "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" o "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("E+ +   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" + oS * + "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" o  o o "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+----"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("SHA256"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("-----+\n")])])]),t("h2",{attrs:{id:"查看生成出来的公钥和私钥"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看生成出来的公钥和私钥"}},[s._v("#")]),s._v(" 查看生成出来的公钥和私钥")]),s._v(" "),t("p",[s._v("默认情况下，ssh 的公钥和私钥会生成到 "),t("code",[s._v("~/.ssh")]),s._v(" 目录下，在服务器 A 执行以下命令：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" ~/.ssh\n")])])]),t("p",[s._v("这个时候，就可以看到生成出来两个文件了。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls ~/.ssh")]),s._v("\nid_rsa  id_rsa.pub\n")])])]),t("blockquote",[t("p",[s._v("文件说明：")]),s._v(" "),t("p",[s._v("id_rsa 是私钥，")]),s._v(" "),t("p",[s._v("id_rsa.pub 是公钥。")]),s._v(" "),t("p",[s._v("查看 id_rsa 文件，可以看到私钥文件的头和尾会有 "),t("code",[s._v("RSA PRIVATE KEY")]),s._v(" 的标识符。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat ~/.ssh/id_rsa")]),s._v("\n-----BEGIN RSA PRIVATE KEY-----\nMIIEogIBAAKCAQEAxTF2b+i+i1rya2AUtEdxLfCX6WiUj4Qr2KxQzJtQbiPUd1ec\nJItacCc6h5IJjFDkelHuAvSfb5aMDZAOCmTtbIqeGGmkVA5zC5HyZBMeaswBjpj/\nmiAF/ndV9ebuq3jbuQ61JkfxYOAseX6Ovbu9HarQfOUef7ot5Irg2wDxfQobeYHz\n7k33D3PcNVqEfPbpFWwYdKGxrJtqh9A8WAeX1EIrgPKndhqQ+ikHnuQcNKjvNGJ+\njgIxs99Q2cdXI93b0NOz3SvwayFZt2VxV8j0qwThfvqGrld26eg6XcDBCTCnwBtK\nDXjuh/Bnr0dI5Q/4DTL1Z2lpEE1Ny/SeTmkAVQIDAQABAoIBADEgRHhWzHmdO72i\nXyYWkky2nrHoevJSJDZDn5GJs/zscjcVHXJBQVOlgkBaEoThdjo/BQO5e6rqH5QV\naloOkNO0qPQ+BVFnlCOyxWdHGBHVJyImXa9BAR1HD6RGVvljD6JH1rtluu2+i3Xt\nIJSGG/QzJOOolPOPJ3XDX4dP8dmLZXbD5KUMmlhiIJanafldJ2rD2tZLdxbTr6me\nqQsTkQEnIYdBvo4yp99dWaWj03B/kSWPS6tqq1zlMlguahIycgywaiFIfk1mBw2L\nr7FymXl6F2ipXUcdl6v5cNNuQPG/Xws7LhEW3Jpd+Tp3/ZvHvnImlyBph2hQJt4F\nYgw/s2ECgYEA+nFKIT2tOr0skfa3bCWx742Ozhhcy88zmUKYN4bZyalLKJDXqajp\n057IeC+AfdxTIJm5E95XNdgTn146Yeb+YJTwx5SElgLZCDQ75fCCrgcm9ldujbm0\nxhXHYZJ5Y5gdjOS9j4jx83AHWpBYbYuGqXHKr9LoBUYpdASjEPe43d0CgYEAyZGs\n0T+TDo+T/qw0q3s0d7SQAyA6NtBVEp4x+MeCwYDO7IKUWqQbTfwa0UYQ7GCJFbF3\n9biln/eyTelbuGA45eJVTuGtJTlZMr12gv9AdcWJpI2n0gAFWYwgRRQ8BdcMqfRn\nIbNY91enhF9fXz/tFpHrrYENcT7BeXDThNCRsNkCgYA7sqGfBtqyM8HaEVtrthiS\nJ8YwrnIASyXblJpAMi7b+TTnOI+P66nBPgo/S+NvHQPbs4kAiXF0bktPI+D60Vs1\nnos+p9JrB8bAQ+M7Tnd4EFBjTDgYJHpI9YwPYCD7cpkoqqXc/yHdi4jVN688fZPd\n9DgCbV3NVAoxk6FjPAmfKQKBgHk+zAINyKpAiRfug7wGXxgGH34R25JvHE0XpR1s\n/OTiUxWGsjAXeGkfVQ4+pB1bL/pBhtPiXpXri3A8BzTPhEobK49IRjsW1OWle2zu\nltqAmPvHTYQPCSjFFgAXXMdyhKaSYZqu47vcGOKR768+p6Ek4uu5rdlJk102FbVV\nM915AoGAMiG3xhSS3Ne3cVBWvNogCi5EU8y8O+ojjd+Tn/UzuidCzwkBG9wSIWDB\nIUNngjC/SZtKuQl2RPBu8A/nnwOmhb38key0xj7y9B4mKVO+zsL2CqaiETHnYARu\ngwyRKfv5tasnQpJh7+THOLCKI7NjHt8E6/t5hqrOOV7ijAAd+Gs"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\n-----END RSA PRIVATE KEY-----\n")])])]),t("p",[s._v("查看 id_rsa.pub 文件，可以看到以 "),t("code",[s._v("ssh-rsa")]),s._v(" 开头，其中 "),t("code",[s._v("rsa")]),s._v(" 是默认的加解密算法。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat ~/.ssh/id_rsa.pub ")]),s._v("\nssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDFMXZv6L6LWvJrYBS0R3Et8JfpaJSPhCvYrFDMm1BuI9R3V5wki1pwJzqHkgmMUOR6Ue4C9J9vlowNkA4KZO1sip4YaaRUDnMLkfJkEx5qzAGOmP+aIAX+d1X15u6reNu5DrUmR/Fg4Cx5fo69u70dqtB85R5/ui3kiuDbAPF9Cht5gfPuTfcPc9w1WoR89ukVbBh0obGsm2qH0DxYB5fUQiuA8qd2GpD6KQee5Bw0qO80Yn6OAjGz31DZx1cj3dvQ07PdK/BrIVm3ZXFXyPSrBOF++oauV3bp6DpdwMEJMKfAG0oNeO6H8GevR0jlD/gNMvVnaWkQTU3L9J5OaQBV root@localhost.localdomain\n")])])])]),s._v(" "),t("h2",{attrs:{id:"方式一-使用-ssh-copy-id-复制公钥到被控机器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#方式一-使用-ssh-copy-id-复制公钥到被控机器"}},[s._v("#")]),s._v(" 方式一：使用 ssh-copy-id 复制公钥到被控机器")]),s._v(" "),t("p",[t("strong",[s._v("注意：使用 ssh-copy-id 的方式需要知道被控机器的用户名和密码！")])]),s._v(" "),t("p",[s._v("现在要实现服务器 A 免密连接至服务器 B，所以需要把服务器 A （192.168.202.205）的公钥复制给服务器 B（192.168.202.206），在将来如果使用私钥加密一段东西，然后服务器 B 使用公钥可以解开，那就可以完成身份验证进行登录了。")]),s._v(" "),t("h3",{attrs:{id:"复制公钥给被控机器-b"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#复制公钥给被控机器-b"}},[s._v("#")]),s._v(" 复制公钥给被控机器 B")]),s._v(" "),t("p",[s._v("在服务器 A 上执行以下命令，把服务器 A 的公钥复制给被控服务器 B：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("ssh-copy-id root@192.168.202.206\n")])])]),t("p",[s._v("第一次连接至新的服务器，会询问是否要继续连接，输入 "),t("code",[s._v("yes")]),s._v(" 即可：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("Are you sure you want to "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("continue")]),s._v(" connecting "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("yes/no"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("? "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\n")])])]),t("p",[s._v("然后，需要输入被控机器的密码，完成身份验证。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("/usr/bin/ssh-copy-id: INFO: attempting to log "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" with the new key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", to filter out any that are already installed\n/usr/bin/ssh-copy-id: INFO: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" remain to be installed -- "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" you are prompted now it is to "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" the new keys\nroot@192.168.202.206's password:\n")])])]),t("p",[s._v("完整执行日志如下：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ssh-copy-id root@192.168.202.206")]),s._v("\n/usr/bin/ssh-copy-id: INFO: Source of key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" to be installed: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/root/.ssh/id_rsa.pub"')]),s._v("\nThe authenticity of "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'192.168.202.206 (192.168.202.206)'")]),s._v(" can"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'t be established.\nECDSA key fingerprint is SHA256:7blhRI+3Hv46USkbiAmg12Q7+MD2grXVBVfU9TWcK7U.\nECDSA key fingerprint is MD5:2e:92:53:d2:0e:8f:ef:db:87:a7:5f:d6:5e:28:df:b2.\nAre you sure you want to continue connecting (yes/no)? yes\n/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed\n/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys\nroot@192.168.202.206'")]),s._v("s password: \n\nNumber of key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" added: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n\nNow try logging into the machine, with:   "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"ssh 'root@192.168.202.206'\"")]),s._v("\nand check to "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" sure that only the key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" you wanted were added.\n")])])]),t("h3",{attrs:{id:"在被控机器-b-上检查是否复制成功"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#在被控机器-b-上检查是否复制成功"}},[s._v("#")]),s._v(" 在被控机器 B 上检查是否复制成功")]),s._v(" "),t("p",[s._v("在被控机器 B 上执行 "),t("code",[s._v("ls ~/.ssh")]),s._v("，可以看到多了一个 "),t("code",[s._v("authorized_keys")]),s._v(" 文件，如果没有看到这个文件，说明没有复制成功。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls ~/.ssh")]),s._v("\nauthorized_keys\n")])])]),t("p",[s._v("查看文件里的内容：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" ~/.ssh/authorized_keys\n")])])]),t("p",[s._v("可以看到，里面的内容就是服务器 A 的公钥。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat ~/.ssh/authorized_keys")]),s._v("\nssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDFMXZv6L6LWvJrYBS0R3Et8JfpaJSPhCvYrFDMm1BuI9R3V5wki1pwJzqHkgmMUOR6Ue4C9J9vlowNkA4KZO1sip4YaaRUDnMLkfJkEx5qzAGOmP+aIAX+d1X15u6reNu5DrUmR/Fg4Cx5fo69u70dqtB85R5/ui3kiuDbAPF9Cht5gfPuTfcPc9w1WoR89ukVbBh0obGsm2qH0DxYB5fUQiuA8qd2GpD6KQee5Bw0qO80Yn6OAjGz31DZx1cj3dvQ07PdK/BrIVm3ZXFXyPSrBOF++oauV3bp6DpdwMEJMKfAG0oNeO6H8GevR0jlD/gNMvVnaWkQTU3L9J5OaQBV root@localhost.localdomain\n")])])]),t("blockquote",[t("p",[s._v("既然 ssh-copy-id 命令的作用就是把服务器 A 的公钥复制到被控机器 B 的 "),t("code",[s._v("authorized_keys")]),s._v(" 文件下，那我直接在被控机器 B 上手动把公钥复制进去不就好了吗？对的，当我们不知道被控机器的密码的时候，但是又需要实现免密登录，就可以用这种方式。")])]),s._v(" "),t("h3",{attrs:{id:"测试是否可以免密连接至被控机器-b"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#测试是否可以免密连接至被控机器-b"}},[s._v("#")]),s._v(" 测试是否可以免密连接至被控机器 B")]),s._v(" "),t("p",[s._v("接下来，在服务器 A 上测试是否可以免密连接至服务器 B：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" root@192.168.202.206\n")])])]),t("p",[s._v("看到以下提示，说明免密登录配置成功了。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ssh root@192.168.202.206")]),s._v("\nLast login: Thu May "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":57:22 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v(" from "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".202.205\n")])])]),t("h2",{attrs:{id:"方式二-在被控机器-b-上手动创建-authorized-keys-文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#方式二-在被控机器-b-上手动创建-authorized-keys-文件"}},[s._v("#")]),s._v(" 方式二：在被控机器 B 上手动创建 authorized_keys 文件")]),s._v(" "),t("p",[s._v("通过 "),t("code",[s._v("ssh-copy-id")]),s._v(" 命令本质上还是在被控机器上的 "),t("code",[s._v("authorized_keys")]),s._v(" 文件写入服务器 A 的公钥，所以当我们不知道被控机器 B 的服务器用户名密码的时候，可以使用这种方式在被控机器 B 上添加服务器 A 的公钥。")]),s._v(" "),t("h3",{attrs:{id:"查看服务器-a-的公钥"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看服务器-a-的公钥"}},[s._v("#")]),s._v(" 查看服务器 A 的公钥")]),s._v(" "),t("p",[s._v("在主动连接至其他服务器 A 的公钥上执行以下命令，查看公钥：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" ~/.ssh/id_rsa.pub\n")])])]),t("p",[s._v("执行日志如下：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat ~/.ssh/id_rsa.pub")]),s._v("\nssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCfavmVZPKDzhwQIgeXdsQOmzVwcHjOaVCaiECef8bLTVLjeTZK6V5gjxHxrs9YFwxq/XJFy085VVYIpeCwaCfDj9rH94AKTVnE612hO9xLRnnNp+HEKi+LQG+zQ3I1tTeSAUZHhMiWIsOe2g3ic9q2Ccj++n3/bLbdgWVBfyrnd09E1vfXa1QlLtgUqCBcEVCwHxvufw0/5Zn42OzVPAJ9WgOqREF+Yz7q1TErbDNjyqnaT9b9519/4x9uUrcG26iP1qV0bg97kW4HmQmH1G7cEr7pWGP1eI55ACV2p47AAMYE9ug250qLGxLBuC99jQcnHgbMzsPJslq5D5GGcTlf root@localhost.localdomain\n")])])]),t("p",[s._v("其中，公钥为：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCfavmVZPKDzhwQIgeXdsQOmzVwcHjOaVCaiECef8bLTVLjeTZK6V5gjxHxrs9YFwxq/XJFy085VVYIpeCwaCfDj9rH94AKTVnE612hO9xLRnnNp+HEKi+LQG+zQ3I1tTeSAUZHhMiWIsOe2g3ic9q2Ccj++n3/bLbdgWVBfyrnd09E1vfXa1QlLtgUqCBcEVCwHxvufw0/5Zn42OzVPAJ9WgOqREF+Yz7q1TErbDNjyqnaT9b9519/4x9uUrcG26iP1qV0bg97kW4HmQmH1G7cEr7pWGP1eI55ACV2p47AAMYE9ug250qLGxLBuC99jQcnHgbMzsPJslq5D5GGcTlf root@localhost.localdomain\n")])])]),t("h3",{attrs:{id:"在被控服务器-b-上写入服务器-a-的公钥"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#在被控服务器-b-上写入服务器-a-的公钥"}},[s._v("#")]),s._v(" 在被控服务器 B 上写入服务器 A 的公钥")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p ~/.ssh "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCfavmVZPKDzhwQIgeXdsQOmzVwcHjOaVCaiECef8bLTVLjeTZK6V5gjxHxrs9YFwxq/XJFy085VVYIpeCwaCfDj9rH94AKTVnE612hO9xLRnnNp+HEKi+LQG+zQ3I1tTeSAUZHhMiWIsOe2g3ic9q2Ccj++n3/bLbdgWVBfyrnd09E1vfXa1QlLtgUqCBcEVCwHxvufw0/5Zn42OzVPAJ9WgOqREF+Yz7q1TErbDNjyqnaT9b9519/4x9uUrcG26iP1qV0bg97kW4HmQmH1G7cEr7pWGP1eI55ACV2p47AAMYE9ug250qLGxLBuC99jQcnHgbMzsPJslq5D5GGcTlf root@localhost.localdomain"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" ~/.ssh/authorized_keys\n")])])]),t("blockquote",[t("p",[s._v("由于 vi 命令不能创建目录，所以需要先把 "),t("code",[s._v(".ssh")]),s._v(" 目录创建出来。")]),s._v(" "),t("p",[s._v("而且，echo 命令要使用追加符号 "),t("code",[s._v(">>")]),s._v("，而不要使用覆盖 "),t("code",[s._v(">")]),s._v(" 符号，因为被控服务器可能被多台服务器所连接，直接覆盖写入会导致其他的服务器的免密登录失效。")])]),s._v(" "),t("h3",{attrs:{id:"验证是否可以免密连接至被控服务器-b"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#验证是否可以免密连接至被控服务器-b"}},[s._v("#")]),s._v(" 验证是否可以免密连接至被控服务器 B")]),s._v(" "),t("p",[s._v("在被控服务器 B 上添加好服务器 A 的公钥以后，就可以实现免密登录了。")]),s._v(" "),t("p",[s._v("在服务器 A 上执行以下命令，看一下免密登录是否配置成功。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" root@192.168.202.206\n")])])]),t("p",[s._v("看到以下提示，说明配置成功了。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ssh root@192.168.202.206")]),s._v("\nLast login: Thu May "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":29:51 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v(" from "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".202.205\n")])])]),t("h2",{attrs:{id:"无法实现免密登录的排查思路"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#无法实现免密登录的排查思路"}},[s._v("#")]),s._v(" 无法实现免密登录的排查思路")]),s._v(" "),t("p",[s._v("首先，检查被控服务器 B 上是否有服务器 A 的公钥。")]),s._v(" "),t("p",[s._v("在远程至其他服务器上的服务器 A 上执行以下命令，查看公钥：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" ~/.ssh/id_rsa.pub\n")])])]),t("p",[s._v("执行命令如下，可以看到公钥为：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat ~/.ssh/id_rsa.pub")]),s._v("\nssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCfavmVZPKDzhwQIgeXdsQOmzVwcHjOaVCaiECef8bLTVLjeTZK6V5gjxHxrs9YFwxq/XJFy085VVYIpeCwaCfDj9rH94AKTVnE612hO9xLRnnNp+HEKi+LQG+zQ3I1tTeSAUZHhMiWIsOe2g3ic9q2Ccj++n3/bLbdgWVBfyrnd09E1vfXa1QlLtgUqCBcEVCwHxvufw0/5Zn42OzVPAJ9WgOqREF+Yz7q1TErbDNjyqnaT9b9519/4x9uUrcG26iP1qV0bg97kW4HmQmH1G7cEr7pWGP1eI55ACV2p47AAMYE9ug250qLGxLBuC99jQcnHgbMzsPJslq5D5GGcTlf root@localhost.localdomain\n")])])]),t("p",[s._v("然后，在被控服务器 B 上查看已授权的公钥：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" ~/.ssh/authorized_keys\n")])])]),t("p",[s._v("可以看到，被控服务器 B 中有服务器 A 的公钥，这个时候是正常的。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat ~/.ssh/authorized_keys ")]),s._v("\nssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCfavmVZPKDzhwQIgeXdsQOmzVwcHjOaVCaiECef8bLTVLjeTZK6V5gjxHxrs9YFwxq/XJFy085VVYIpeCwaCfDj9rH94AKTVnE612hO9xLRnnNp+HEKi+LQG+zQ3I1tTeSAUZHhMiWIsOe2g3ic9q2Ccj++n3/bLbdgWVBfyrnd09E1vfXa1QlLtgUqCBcEVCwHxvufw0/5Zn42OzVPAJ9WgOqREF+Yz7q1TErbDNjyqnaT9b9519/4x9uUrcG26iP1qV0bg97kW4HmQmH1G7cEr7pWGP1eI55ACV2p47AAMYE9ug250qLGxLBuC99jQcnHgbMzsPJslq5D5GGcTlf root@localhost.localdomain\n")])])]),t("p",[s._v("如果，检查完以上后还是没办法连接，可以检查下文件权限。")]),s._v(" "),t("p",[s._v("查看服务器 A 的文件权限：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" -l ~/.ssh/\n")])])]),t("p",[s._v("执行日志如下：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls -l ~/.ssh/")]),s._v("\n总用量 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("\n-rw-------. "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1675")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("月  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":18 id_rsa\n-rw-r--r--. "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("408")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("月  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":18 id_rsa.pub\n-rw-r--r--. "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("177")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("月  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":28 known_hosts\n")])])]),t("p",[s._v("可以看到，私钥文件 "),t("code",[s._v("id_rsa")]),s._v(" 只有拥有者才有读和写的权限，其他群组和用户都没有任何读写执行权限。而公钥文件 "),t("code",[s._v("id_rsa.pub")]),s._v(" 和记录已确认连接其他服务器的 "),t("code",[s._v("known_hosts")]),s._v(" 所有人都可以读，但是只有拥有者才可以写，并且所有人都不能执行。")]),s._v(" "),t("p",[s._v("如果文件权限不对，需要执行以下命令修改文件权限：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v(" ~/.ssh/id_rsa\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("644")]),s._v(" ~/.ssh/id_rsa.pub\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("644")]),s._v(" ~/.ssh/known_hosts\n")])])]),t("blockquote",[t("p",[s._v("说明：r=4，w=2，x=1")])]),s._v(" "),t("p",[s._v("查看被控服务器 B 的文件权限：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" -l ~/.ssh\n")])])]),t("p",[s._v("执行日志如下：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls -l ~/.ssh")]),s._v("\n总用量 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\n-rw-r--r--. "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("408")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("月  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":29 authorized_keys\n")])])]),t("p",[s._v("可以看到，authorized_keys 文件的权限只有拥有者才有写入权限，其他用户、群组只有读的权限，并且所有用户和群组都没有执行权限。")]),s._v(" "),t("p",[s._v("如果文件权限不对，执行以下命令修改文件权限：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("644")]),s._v(" ~/.ssh/authorized_keys\n")])])]),t("blockquote",[t("p",[s._v("被控服务器的文件权限有问题是最致命的，因为你在连接的时候看不到任何的错误提示！而且一般都是这个问题导致的免密连接不成功。")])]),s._v(" "),t("h2",{attrs:{id:"具体错误的解决方案"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#具体错误的解决方案"}},[s._v("#")]),s._v(" 具体错误的解决方案")]),s._v(" "),t("h3",{attrs:{id:"warning-unprotected-private-key-file"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#warning-unprotected-private-key-file"}},[s._v("#")]),s._v(" WARNING: UNPROTECTED PRIVATE KEY FILE!")]),s._v(" "),t("p",[s._v("这是因为，私钥文件设置了 "),t("code",[s._v("777")]),s._v("，可以被所有人访问到，太不安全了，所以被安全策略阻止了，不能远程访问。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ssh root@192.168.202.206")]),s._v("\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\n@         WARNING: UNPROTECTED PRIVATE KEY FILE"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("          @\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\nPermissions 0777 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/root/.ssh/id_rsa'")]),s._v(" are too open.\nIt is required that your private key files are NOT accessible by others.\nThis private key will be ignored.\nLoad key "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/root/.ssh/id_rsa"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" bad permissions\nroot@192.168.202.206"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s password: \nPermission denied, please try again.\nroot@192.168.202.206'")]),s._v("s password: \nPermission denied, please try again.\nroot@192.168.202.206's password: \nPermission denied "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("publickey,gssapi-keyex,gssapi-with-mic,password"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(".\n")])])]),t("p",[s._v("解决方案：修改文件权限")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v(" ~/.ssh/id_rsa\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("644")]),s._v(" ~/.ssh/id_rsa.pub\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("644")]),s._v(" ~/.ssh/known_hosts\n")])])]),t("h2",{attrs:{id:"ssh-免密登录的缺点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ssh-免密登录的缺点"}},[s._v("#")]),s._v(" ssh 免密登录的缺点")]),s._v(" "),t("p",[s._v("虽然，ssh 免密登录非常方便，但是也不是绝对的安全的。")]),s._v(" "),t("p",[s._v("当我们修改了用户的密码的时候，ssh 公钥依然有效，所以一旦配置好了 ssh 之后，修改用户的密码对 ssh 是没有影响的，而一旦 ssh 密钥泄露，就可以被伪造进行登录了！")]),s._v(" "),t("p",[s._v("在网络安全中，这也是种后门，可以通过这个方式来检查服务器是否被留后门。")]),s._v(" "),t("blockquote",[t("p",[s._v("参考资料：")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://blog.csdn.net/jeikerxiao/article/details/84105529",target:"_blank",rel:"noopener noreferrer"}},[s._v("SSH 三步解决免密登录"),t("OutboundLink")],1)])])])}),[],!1,null,null,null);a.default=e.exports}}]);