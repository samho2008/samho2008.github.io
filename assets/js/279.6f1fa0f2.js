(window.webpackJsonp=window.webpackJsonp||[]).push([[279],{2157:function(s,t,e){"use strict";e.r(t);var r=e(34),a=Object(r.a)({},(function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"如何理解redis中rdb方式的持久化"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#如何理解redis中rdb方式的持久化"}},[s._v("#")]),s._v(" 如何理解Redis中RDB方式的持久化？")]),s._v(" "),e("p",[s._v("RDB 方式的持久化是 Redis 数据库默认的持久化机制，是保证 redis 中数据可靠性的方式之一，这种方式可以按照一定的时间周期策略把内存中的数据以快照（二进制数据）的形式保存到磁盘文件中，即快照存储。")]),s._v(" "),e("p",[s._v("对应产生的数据文件为 dump.rdb。")]),s._v(" "),e("h2",{attrs:{id:"rdb-常用参数配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#rdb-常用参数配置"}},[s._v("#")]),s._v(" RDB 常用参数配置")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这里表示每隔60s，如果有超过1000个key发生了变更，就执行一次数据持久化。")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这个操作也被称之为snapshotting(快照)。")]),s._v("\nsave "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 持久化 rdb文件遇到问题时，主进程是否接受写入，yes 表示停止写入，")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果是no 表示redis继续提供服务。")]),s._v("\nstop-writes-on-bgsave-error "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v(" \n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在进行快照镜像时,是否进行压缩。yes:压缩，")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 但是需要一些cpu的消耗。no:不压缩，需要更多的磁盘空间。")]),s._v("\nrdbcompression "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 一个CRC64的校验就被放在了文件末尾，当存储或者加载rbd文件的时候")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 会有一个10%左右的性能下降，为了达到性能的最大化，你可以关掉这个配置项。")]),s._v("\nrdbchecksum "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 快照的文件名")]),s._v("\ndbfilename dump.rdb\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 存放快照的目录")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("dir")]),s._v(" /var/lib/redis\n")])])]),e("h2",{attrs:{id:"rdb-持久化时机"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#rdb-持久化时机"}},[s._v("#")]),s._v(" RDB 持久化时机")]),s._v(" "),e("ol",[e("li",[s._v("基于配置文件中的 save 规则周期性的执行持久化。")]),s._v(" "),e("li",[s._v("手动执行了 shutdown 操作会自动执行 rdb 方式的持久化。")]),s._v(" "),e("li",[s._v("手动调用了 save 或 bgsave 指令执行数据持久化。")]),s._v(" "),e("li",[s._v("主从复制 (Master/Slave) 架构下 Slave 连接到 Master 时，Master 会对数据持久化，然后全量同步到Slave。")])]),s._v(" "),e("h2",{attrs:{id:"rdb-的优点"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#rdb-的优点"}},[s._v("#")]),s._v(" RDB 的优点")]),s._v(" "),e("ol",[e("li",[s._v("RDB 文件是经过压缩的二进制文件，占用空间很小，它保存了 Redis 某个时间点的数据集，很适合做备份。")]),s._v(" "),e("li",[s._v("RDB 非常适用于灾难恢复，它只有一个文件，并且内容都非常紧凑，可以（在加密后）将它传送到别的数据中心。")]),s._v(" "),e("li",[s._v("RDB 方式持久化性能较好，执行持久化时可以 fork 一个子进程，由子进程处理保存工作，父进程无须执行任何磁盘 I/O 操作。")])]),s._v(" "),e("h2",{attrs:{id:"rdb-的缺点"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#rdb-的缺点"}},[s._v("#")]),s._v(" RDB 的缺点")]),s._v(" "),e("ol",[e("li",[s._v("RDB 方式在服务器故障时容易造成数据的丢失。实际项目中，我们可通过配置来控制持久化的频率。但是，如果频率太频繁，可能会对 Redis 性能产生影响。所以通常可能设置至少 5 分钟才保存一次快照，这时如果 Redis 出现宕机等情况，则意味着最多可能丢失 5 分钟数据。")]),s._v(" "),e("li",[s._v("RDB 方式使用 fork 子进程进行数据的持久化，子进程的内存是在 fork 操作时父进程中数据快照的大小，如果数据快照比较大的话，fork 时开辟内存会比较耗时，同时这个 fork 是同步操作，所以，这个过程会导致父进程无法对外提供服务。")]),s._v(" "),e("li",[s._v("RDB 持久化过程中的 fork 操作，可能会导致内存占用加倍，Linux 系统 fork 子进程采用的是 copy-on-write 的方式（写时复制，修改前先复制），在 Redis 执行 RDB 持久化期间，如果 client 写入数据很频繁，那么将增加 Redis 占用的内存，最坏情况下，内存的占用将达到原先的 2 倍。")])]),s._v(" "),e("blockquote",[e("p",[s._v("参考资料：")]),s._v(" "),e("p",[e("a",{attrs:{href:"https://mp.weixin.qq.com/s/_x5m1U34TNZ2c3ANkmtkHg",target:"_blank",rel:"noopener noreferrer"}},[s._v("如何理解Redis中RDB方式的持久化？"),e("OutboundLink")],1)])])])}),[],!1,null,null,null);t.default=a.exports}}]);