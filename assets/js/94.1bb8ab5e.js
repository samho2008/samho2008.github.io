(window.webpackJsonp=window.webpackJsonp||[]).push([[94],{2010:function(t,a,s){"use strict";s.r(a);var e=s(34),n=Object(e.a)({},(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"gitlab-配置系统发件邮箱"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#gitlab-配置系统发件邮箱"}},[t._v("#")]),t._v(" GitLab 配置系统发件邮箱")]),t._v(" "),e("p",[t._v("本文介绍如何为 Gitlab 服务配置邮箱，实现服务器向用户自动发送邮件。")]),t._v(" "),e("p",[t._v("发邮件的使用场景有很多，比如："),e("code",[t._v("用户忘记密码后申请密码重置")]),t._v("，"),e("code",[t._v("用户自行注册账户时，接受邮件用于验证账户")]),t._v("等。")]),t._v(" "),e("h2",{attrs:{id:"一-配置前准备工作及说明"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一-配置前准备工作及说明"}},[t._v("#")]),t._v(" 一. 配置前准备工作及说明")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("服务器系统版本：CentOS 7")])]),t._v(" "),e("li",[e("p",[t._v("需要服务 postfix，并在终端运行 "),e("code",[t._v("systemctl status postfix")]),t._v(" 检查服务是否已在运行状态，如果看到绿色的小圆点或者 "),e("code",[t._v("active (running)")]),t._v(" 则表示服务正在运行。")])]),t._v(" "),e("li",[e("p",[t._v("若在安装 Gitlab 之前未安装 postfix，则需运行以下命令安装并启动 postfix 服务。")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" yum -y "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" postfix\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" systemctl "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("enable")]),t._v(" postfix\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" systemctl start postfix\n")])])])]),t._v(" "),e("li",[e("p",[t._v("邮箱信息准备，以QQ邮箱为例。")]),t._v(" "),e("ul",[e("li",[t._v("邮箱地址："),e("code",[t._v("xxxxxxxx@qq.com")])]),t._v(" "),e("li",[t._v("SMTP服务器地址：一般是 "),e("code",[t._v("smtp.qq.com")])]),t._v(" "),e("li",[t._v("SMTP服务器端口号：一般是 "),e("code",[t._v("456")])]),t._v(" "),e("li",[t._v("登录QQ邮箱并生成QQ邮箱第三方登录授权码")])]),t._v(" "),e("p",[t._v("打开 QQ 邮箱："),e("a",{attrs:{href:"https://mail.qq.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://mail.qq.com/"),e("OutboundLink")],1)]),t._v(" "),e("p",[t._v("点击上方的设置，跳转到邮箱设置，然后点击账户。")]),t._v(" "),e("p",[e("img",{attrs:{src:s(684),alt:"image-20220425080409310"}})]),t._v(" "),e("p",[t._v("向下滚动网页，找到 POP3/IMAP/SMTP/Exchange/CardDAV/CalDAV服务，然后点击 "),e("code",[t._v("生成授权码")]),t._v("，同时确保 "),e("code",[t._v("POP3/SMTP")]),t._v(" 服务已开启。")])])]),t._v(" "),e("p",[e("img",{attrs:{src:s(685),alt:"image-20220425080851778"}})]),t._v(" "),e("h2",{attrs:{id:"二-编辑-gitlab-配置文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#二-编辑-gitlab-配置文件"}},[t._v("#")]),t._v(" 二. 编辑 GitLab 配置文件")]),t._v(" "),e("ol",[e("li",[t._v("输入以下命令用 vi 打开 GitLab 配置文件，用 "),e("code",[t._v("/smtp")]),t._v(" 快速搜到所在的位置。")])]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("vi")]),t._v(" /etc/gitlab/gitlab.rb\n")])])]),e("ol",{attrs:{start:"2"}},[e("li",[e("p",[t._v("找到如下图所示部分，使用上一步所获得的的信息对其进行更新。")]),t._v(" "),e("p",[e("strong",[t._v("一定要记得将每一行配置信息最前方的 "),e("code",[t._v("#")]),t._v(" 删掉以取消注释。")])]),t._v(" "),e("p",[t._v("修改 smtp_address 为 "),e("code",[t._v("smtp.qq.com")])]),t._v(" "),e("p",[t._v("修改 smtp_domain 为 "),e("code",[t._v("smtp.qq.com")])]),t._v(" "),e("p",[t._v("修改 smtp_user_name 为 QQ邮箱账号")]),t._v(" "),e("p",[t._v("修改 "),e("code",[t._v("smtp_password")]),t._v(" 为 "),e("code",[t._v("QQ邮箱授权码")]),t._v("，"),e("strong",[t._v("并非QQ邮箱登录密码！")])])])]),t._v(" "),e("p",[e("img",{attrs:{src:s(686),alt:"image-20220425083342490"}})]),t._v(" "),e("ol",{attrs:{start:"3"}},[e("li",[e("p",[t._v("修改完成并保存后，在终端运行以下命令使配置生效。")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("gitlab-ctl reconfigure\n")])])])])]),t._v(" "),e("h2",{attrs:{id:"三-测试邮箱设置是否生效"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#三-测试邮箱设置是否生效"}},[t._v("#")]),t._v(" 三. 测试邮箱设置是否生效")]),t._v(" "),e("ol",[e("li",[t._v("在终端运行 "),e("code",[t._v("gitlab-rails console")]),t._v(" 命令进入 GitLab console 命令行，输入以下命令向测试邮箱发送邮件。")])]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("Notify.test_email"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'XXXXXX@gmail.com'")]),t._v(", "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'GitLab Email Title'")]),t._v(", "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Email Content'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(".deliver_now\n")])])]),e("blockquote",[e("p",[t._v("把 "),e("code",[t._v("XXXXXX@gmail.com")]),t._v(" 换成你想要接收邮件的邮箱，也可以和上面配置的发件邮箱用同一个邮箱。（自己给自己发邮件，发件人和收件人都是自己）")])]),t._v(" "),e("ol",{attrs:{start:"2"}},[e("li",[e("p",[t._v("若能看到以下输出信息，则说明发送邮件成功")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("Delivered mail 610835daa71d5_21d35a645978a@sage.novalocal.mail "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("40062")]),t._v(".2ms"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#<Mail::Message:173540, Multipart: false, Headers: <Date: Mon, 02 Aug 2021 18:13:46 +0000>, <From: GitLab <xxxxxx@qq.com>>, <Reply-To: GitLab <noreply@xx.xx.4.62>>, <To: xxxxxxx@gmail.com>, <Message-ID: <610835daa71d5_21d35a645978a@sage.novalocal.mail>>, <Subject: test Gitlab Email>, <Mime-Version: 1.0>, <Content-Type: text/html; charset=UTF-8>, <Content-Transfer-Encoding: 7bit>, <Auto-Submitted: auto-generated>, <X-Auto-Response-Suppress: All>>")]),t._v("\n")])])])]),t._v(" "),e("li",[e("p",[t._v("登录收件邮箱，检查收件箱中是否收到 GitLab 服务器发送过来的测试邮件。")])])]),t._v(" "),e("p",[t._v("用户若忘记密码，在登录页面点击忘记密码，输入注册账户时使用的邮箱，即可从服务器获取重置密码链接的邮件。")]),t._v(" "),e("blockquote",[e("p",[t._v("参考资料：")]),t._v(" "),e("p",[e("a",{attrs:{href:"https://juejin.cn/post/6991924908242501669",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://juejin.cn/post/6991924908242501669"),e("OutboundLink")],1)])])])}),[],!1,null,null,null);a.default=n.exports},684:function(t,a,s){t.exports=s.p+"assets/img/image-20220425080409310.17840318.png"},685:function(t,a,s){t.exports=s.p+"assets/img/image-20220425080851778.20eea996.png"},686:function(t,a,s){t.exports=s.p+"assets/img/image-20220425083342490.e73f0b16.png"}}]);